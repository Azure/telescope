parameters:
  - name: action
    type: string
    default: "deploy"
  - name: cluster_context
    type: string
    default: ""
  - name: namespace
    type: string
    default: "default"

steps:
  - script: |
      set -eo pipefail

      echo "Using AKS Store Demo Python class to ${{ parameters.action }}"
      
      PYTHONPATH=$PYTHONPATH:$(pwd) python3 $PYTHON_SCRIPT \
        --action "${{ parameters.action }}" \
        --cluster-context "${{ parameters.cluster_context }}" \
        --namespace "${{ parameters.namespace }}" \
        --manifests-path "$MANIFESTS_PATH"

    displayName: '${{ parameters.action }} AKS Store Demo'
    workingDirectory: modules/python
    env:
      MANIFESTS_PATH: $(Pipeline.Workspace)/s/scenarios/$(SCENARIO_TYPE)/$(SCENARIO_NAME)/manifests
      PYTHON_SCRIPT: $(Pipeline.Workspace)/s/modules/python/aks_store_demo/aks_store_demo.py
