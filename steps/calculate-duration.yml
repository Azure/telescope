parameters:
- name: start_variable_name
  type: string
  default: 'STEP_START_EPOCH'
- name: duration_variable_name
  type: string
  default: 'STEP_DURATION_MINUTES'
- name: display_name
  type: string
  default: 'Calculate step execution duration'

steps:
- task: Bash@3
  displayName: '${{ parameters.display_name }}'
  continueOnError: true
  inputs:
    targetType: 'inline'
    script: |
      end_epoch=$(date +%s)
      start_epoch="$(${{ parameters.start_variable_name }})"
      
      # Calculate duration in minutes
      duration_seconds=$((end_epoch - start_epoch))
      duration_minutes=$(echo "scale=2; $duration_seconds / 60" | bc -l)
      
      echo "Step execution start time: $(date -d @$start_epoch -u)"
      echo "Step execution end time: $(date -u)"
      echo "Duration in minutes: $duration_minutes"
      
      # Set variable for use in subsequent steps
      echo "##vso[task.setvariable variable=${{ parameters.duration_variable_name }}]$duration_minutes"
