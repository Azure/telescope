parameters:
- name: cloud
  type: string
- name: regions
  type: object

steps:
- script: |
    set -eu
    if [[ "$CLOUD" == "azure" ]]; then
      # For Azure, check if npm_enabled is true
      if [[ "$NPM_ENABLED" == "true" ]]; then
        echo "NPM is enabled, applying kubectl configuration..."
        
        # Get AKS credentials
        aks_name=$(az aks list --resource-group $RUN_ID --query "[0].name" -o tsv)
        az aks get-credentials --resource-group $RUN_ID --name $aks_name --overwrite-existing
        
        # Apply kubectl configuration
        kubectl apply -f ../scripts/azure-npm.yaml
        echo "NPM configuration applied successfully!"
      else
        echo "NPM is not enabled, skipping kubectl configuration."
      fi
    fi