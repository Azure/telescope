parameters:
  - name: cloud
    type: string
  - name: engine
    type: string
  - name: regions
    type: object
  - name: node_count
    type: string

steps:
  - template: /steps/cloud/${{ parameters.cloud }}/update-kubeconfig.yml
    parameters:
      role: slo
      region: ${{ parameters.regions[0] }}
  - template: /steps/engine/clusterloader2/cilium/scale-cluster.yml
    parameters:
      role: slo
      region: ${{ parameters.regions[0] }}
      nodes_per_nodepool: ${{ parameters.node_count }}
      enable_autoscale: "false"
  - script: |
      node_count=${{ parameters.node_count }}
      additional_nodes=6Â 
      total_nodes=$((node_count + additional_nodes))
      echo "##vso[task.setvariable variable=total_nodes;]$total_nodes"
    displayName: 'Calculate Total Nodes'
  - template: /steps/engine/clusterloader2/slo/validate.yml
    parameters:
      validation_timeout_in_minutes: 10
      desired_nodes: $(total_nodes)
