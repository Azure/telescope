steps:
  - script: |
      set -euo pipefail
      set -x
      kustomize build configuration | kubectl apply -f -
      kubectl wait --for=condition=Ready pod -l app=nvme-setup -n kube-system --timeout=600s
      kubectl get pods -n kube-system -l app=nvme-setup -o wide
      kubectl wait --for=condition=Ready pod -l app=local-path-provisioner -n local-path-storage --timeout=600s
      kubectl get pods -n local-path-storage -l app=local-path-provisioner -o wide
    condition: eq(variables.storage_name, 'local-hostpath')
    workingDirectory: modules/kustomize/fio/overlays/local-hostpath
    displayName: "Configure local-hostpath"
