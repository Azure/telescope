parameters:
  - name: additional_nodes
    type: string
    default: "0"
  - name: validation_timeout_in_minutes
    type: number
    default: 10

steps:
  - script: |
      set -eo pipefail
      
      # Add signal handler for graceful cancellation
      trap 'echo "Validation cancelled by user"; exit 143' SIGTERM SIGINT

      PYTHONPATH=$PYTHONPATH:$(pwd) timeout ${VALIDATION_TIMEOUT_IN_MINUTES}m python3 $PYTHON_SCRIPT_FILE validate \
        $NODE_COUNT $VALIDATION_TIMEOUT_IN_MINUTES $NODE_LABEL
    workingDirectory: modules/python
    timeoutInMinutes: ${{ parameters.validation_timeout_in_minutes }}
    displayName: "Validate node count"
    condition: eq(variables['SCALENODES'], 'true')
    env:
      VALIDATION_TIMEOUT_IN_MINUTES: ${{ parameters.validation_timeout_in_minutes }}
      PYTHON_SCRIPT_FILE: $(Pipeline.Workspace)/s/modules/python/clusterloader2/swiftv2-slo/slo.py
