parameters:
  cloud: ''
  result_dir: ''
  disk_number: 1
  storage_class: ''

steps:
- script: |
    set -eu
    source ./attach-detach.sh

    echo "Starting running attach detach test with $DISK_NUMBER disks and $STORAGE_CLASS storage class"
    azure_run_attach_detach_test $DISK_NUMBER $STORAGE_CLASS $RESULT_DIR
    echo "sleep 5 minutes to detach all the resource ..."
    sleep 5m
  displayName: "Execute Test attach detach ${{ parameters.disk_number }}"
  workingDirectory: modules/python
  env:
    CLOUD: ${{ parameters.cloud }}
    DISK_NUMBER: ${{ parameters.disk_number }}
    STORAGE_CLASS: ${{ parameters.storage_class }}
    RESULT_DIR: ${{ parameters.result_dir }}
    DEBUG: "true"
