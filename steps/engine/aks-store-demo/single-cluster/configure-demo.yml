parameters:
  - name: cloud
    type: string
    default: ""
  - name: regions
    type: object
    default: {}
  - name: cluster_context
    type: string
    default: ""
  - name: action
    type: string
    default: "apply"

steps:
  - template: /steps/common/kubectl-manifest.yml
    parameters:
      cluster_context: ${{ parameters.cluster_context }}
      action: ${{ parameters.action }}
      manifest_file: "$(Pipeline.Workspace)/s/scenarios/$(SCENARIO_TYPE)/$(SCENARIO_NAME)/manifests/aks-store-all-in-one.yaml"
      wait_condition: "condition=Available"
      wait_resource: "deployment"
      timeout: "600s"
  - template: /steps/common/kubectl-manifest.yml
    parameters:
      cluster_context: ${{ parameters.cluster_context }}
      action: ${{ parameters.action }}
      manifest_file: "$(Pipeline.Workspace)/s/scenarios/$(SCENARIO_TYPE)/$(SCENARIO_NAME)/manifests/aks-store-virtual-worker.yaml"
      wait_condition: "condition=Available"
      wait_resource: "deployment/virtual-worker"
      timeout: "60s"
  - template: /steps/common/kubectl-manifest.yml
    parameters:
      cluster_context: ${{ parameters.cluster_context }}
      action: ${{ parameters.action }}
      manifest_file: "$(Pipeline.Workspace)/s/scenarios/$(SCENARIO_TYPE)/$(SCENARIO_NAME)/manifests/aks-store-virtual-customer.yaml"
      wait_condition: "condition=Available"
      wait_resource: "deployment/virtual-customer"
      timeout: "60s"
