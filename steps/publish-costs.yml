parameters:
- name: cloud
  type: string
- name: credential_type
  type: string

steps:
# Debug: Always show the variable value
- script: echo "collect_k8s_cost variable value is '$(collect_k8s_cost)'"
  displayName: "Debug: Show collect_k8s_cost variable value"

# Debug: Show the parameter value
- script: echo "collect_k8s_cost parameter value is '${{ parameters.collect_k8s_cost }}'"
  displayName: "Debug: Show collect_k8s_cost parameter value"

# Debug: Show if condition evaluation result
- script: echo "Template condition evaluated to include upload steps"
  displayName: "Debug: Condition = TRUE - Upload steps will run"
  condition: eq(variables['collect_k8s_cost'], 'true')

- script: echo "Template condition evaluated to exclude upload steps"
  displayName: "Debug: Condition = FALSE - Upload steps will NOT run"
  condition: ne(variables['collect_k8s_cost'], 'true')

- template: /steps/cloud/azure/upload-storage-account.yml
  parameters:
    source_file_name: $(ALLOCATION_K8S_COST_FILE_PATH)
    subfolder: $(SCENARIO_TYPE)/$(SCENARIO_NAME)/k8s-cost-analysis/allocation/$(Build.SourceBranchName)
    container_name: cost
    credential_type: ${{ parameters.credential_type }}
    cloud: ${{ parameters.cloud }}
    upload_type: "Cost Results - Allocation"
    custom_condition: eq(variables['collect_k8s_cost'], true)

- template: /steps/cloud/azure/upload-storage-account.yml
  parameters:
    source_file_name: $(ASSETS_K8S_COST_FILE_PATH)
    subfolder: $(SCENARIO_TYPE)/$(SCENARIO_NAME)/k8s-cost-analysis/assets/$(Build.SourceBranchName)
    container_name: cost
    credential_type: ${{ parameters.credential_type }}
    cloud: ${{ parameters.cloud }}
    upload_type: "Cost Results - Assets"
    custom_condition: eq(variables['collect_k8s_cost'], false)
