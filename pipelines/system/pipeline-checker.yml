trigger: none

variables:
  ORG_URL: https://dev.azure.com/msazure
  PROJECT: CloudNativeCompute

jobs:
  - job: pipeline_checker
    continueOnError: false
    steps:
      - script: |
          set -eu

          az login --identity --client-id $AZURE_MI_ID
          token=$(az account get-access-token --query "accessToken" -o tsv)
          echo "##vso[task.setvariable variable=DEVOPS_ACCESS_TOKEN;issecret=true]$token"
        env:
          AZURE_MI_ID: $(AZURE_MI_CLIENT_ID)
        displayName: "Get ADO token"
      - script: |
          set -eu
          PYTHONPATH=$PYTHONPATH:$(pwd) python3 $PYTHON_SCRIPT_FILE --org $ORG --project $PROJECT --pat $TOKEN

        displayName: "Run syntax check"
        workingDirectory: modules/python/pipeline
        env:
          PYTHON_SCRIPT_FILE: $(Pipeline.Workspace)/s/modules/python/pipeline/pipeline.py
          ORG: $(ORG_NAME)
          PROJECT: $(PROJECT)
          TOKEN: $(DEVOPS_ACCESS_TOKEN)
