apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namePrefix: server-
resources:
  - ../../base

patches:
  - target:
      kind: Deployment
      name: iperf3-deployment
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: iperf3-deployment
      spec:
        template:
          spec:
            hostNetwork: true
            nodeSelector:
              app: server-
            containers:
              - name: iperf3-server
                args: ["-c", "ldconfig; iperf3 -s -p 20003"]
                ports:
                  - containerPort: 20003
labels:
  - includeSelectors: true
    pairs:
      app: iperf3-server
