name: kuberay
namespace:
  number: 10
  prefix: test

tuningSets:
- name: Uniform100qps
  qpsLoad:
    qps: 100

steps:
- name: Start measurements
  measurements:
  - Identifier: PodStartupLatency
    Method: PodStartupLatency
    Params:
      action: start
      labelSelector: app.kubernetes.io/created-by = kuberay-operator
      threshold: 30m
  - Identifier: JobLifecycleLatency
    Method: JobLifecycleLatency
    Params:
      action: start
      labelSelector: app.kubernetes.io/created-by = kuberay-operator
      threshold: 30m
  - Identifier: SchedulingThroughput
    Method: SchedulingThroughput
    Params:
      action: start
      labelSelector: app.kubernetes.io/created-by = kuberay-operator
      measurmentInterval: 1s

- name: Creating RayJobs for PyTorch MNIST fine-tuning
  phases:
  - namespaceRange:
      min: 1
      max: 10
    replicasPerNamespace: 100
    tuningSet: Uniform100qps
    objectBundle:
    - basename: pytorch-mnist
      objectTemplatePath: pytorch-mnist-rayjob.yaml
      templateFillMap:
        Image: "rayproject/ray:2.46.0" # replace with image built from images/ray-pytorch

- name: Wait for RayJobs complete
  measurements:
  - Identifier: WaitForRayJob
    Method: Exec
    Params:
      streamOutput: true
      timeout: 30m
      command:
      - "bash"
      - "../cl2/wait-for-jobs.sh"
      - "1000"

- name: Collect measurements
  measurements:
    - Identifier: SchedulingThroughput
      Method: SchedulingThroughput
      Params:
        action: gather
        timeout: 3h
    - Identifier: PodStartupLatency
      Method: PodStartupLatency
      Params:
        action: gather
        timeout: 3h
    - Identifier: JobLifecycleLatency
      Method: JobLifecycleLatency
      Params:
        action: gather
        timeout: 3h